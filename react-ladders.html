
<!DOCTYPE html>
<html>

<head>

  <meta charset="UTF-8">

  <meta name="robots" content="noindex">

  <title>CodePen - Futures Ladder JSX - Realistic</title>

  <link rel='stylesheet prefetch' href='http://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700'>
<link rel='stylesheet prefetch' href='http://boomtownroi.github.io/boomstrap/css/boomstrap.css'>

  <style>* {
  box-sizing: border-box;
}
html,
body {
  margin: 0;
  padding: 0;
}
body {
  background-color: #455A64;
  color: #212121;
  font-family: Verdana;
  font-size: 11px;
  padding-bottom: 100px;
}
.ladder-row {
  display: table-row;
}
.ladder-cell {
  display: table-cell;
  width: 120px;
  position: relative;
  height: 24px;
  padding: 0;
  line-height: 24px;
  vertical-align: top;
  text-align: center;
}
.ladder-cell-price {
  background-color: rgba(0, 0, 0, 0.05);
}
.component {
  display: inline-block;
  margin: 14px 0 0 14px;
  background-color: #fff;
}
.ladder-row:nth-child(odd) {
  background-color: #F5F5F5;
}
.app-header {
  background-color: #5F7C8A;
  color: #fff;
  font-size: 20px;
  padding: 30px;
  margin: 0;
}
.component header {
  background-color: #CFD8DC;
  font-size: 14px;
  padding: 10px;
}
/* NumberBar */
.numberbar {
  position: relative;
  width: 100%;
  height: 100%;
  overflow: hidden;
}
.numberbar-bar {
  position: absolute;
  top: 0;
  left: 0;
  background-color: #b1cfa7;
  height: 100%;
  width: 100%;
  z-index: 1;
}
.transitions .numberbar-bar {
  transition: transform 0.13s ease-out;
}
.numberbar-bar-ask {
  left: auto;
  right: 0;
  background-color: #e9aebc;
}
.numberbar-number {
  position: relative;
  z-index: 5;
}</style>

</head>

<body>

  <header class="app-header">SBI Trader
<div class="transition-control">
  Transitions
  <input type="checkbox" checked>
</div>
</header>
<div id="main">
</div>

  <script src='http://mfunkie.github.io/ReactCodePen/react-codepen.js'></script><script src='http://fb.me/react-with-addons-0.12.2.min.js'></script><script src='http://fb.me/JSXTransformer-0.10.0.js'></script><script src='https://rawgit.com/MikeMcl/big.js/master/big.js'></script>

  <script>
    /**@jsx React.DOM*/
/*http://fb.me/react-0.11.1.js
http://fb.me/react-with-addons-0.12.2.min.js*/

var THROTTLE = 50;
var NUMBER_OF_LADDERS = 20;

/*var THROTTLE = 10000;
var NUMBER_OF_LADDERS = 1;*/

var NumberBar = React.createClass({

  getInitialState: function() {
    return {
      mouseOver: false,
      barClass: "numberbar-bar numberbar-bar-" + this.props.type,
      selected: false
    }
  },

  mouseOver: function() {
    this.setState({
      mouseOver: true
    })
  },

  mouseOut: function() {
    this.setState({
      mouseOver: false
    })
  },

  getBarStyle: function() {
    var ratio = this.props.number / this.props.maxNumber;
    var value = ratio * this.props.maxBarWidth + "px";
    var display = this.state.mouseOver || this.state.selected ? "none" : "";
    var translate = (1 - ratio) * 100;

    if (this.props.type === "ask") {
      translate = -translate;
    }

    return {
      display: display,
      transform: "translateX(" + translate + "%)"
    }
  },

  getNumberBarStyle: function() {
    var background, color;

    if (this.state.selected) {
      background = "rgb(100,100,100)";
      color = "#ffffff";
    } else if (this.state.mouseOver) {
      background = "rgb(200,200,200)";
      color = "";
    } else {
      background = "";
      color = "";
    }

    return {
      backgroundColor: background,
      color: color
    };
  },

  click: function() {
    this.setState({
      selected: !this.state.selected
    })
  },

  render: function() {
    return (
      <div className="numberbar" onMouseOver={this.mouseOver} onMouseOut={this.mouseOut} onClick={this.click} style={this.getNumberBarStyle()}>
        <div className={this.state.barClass} style={this.getBarStyle()}></div>
        <div className="numberbar-number">{this.props.number}</div>
      </div>
    )
  }
});

var LadderRow = React.createClass({
  render: function() {
    return (
      <div className="ladder-row">
        <div className="ladder-cell">
          <NumberBar
            type="bid"
            number={this.props.bidAmount}
            maxNumber={this.props.maxAmount}
            maxBarWidth={this.props.maxBarWidth}
          ></NumberBar>
        </div>
        <div className="ladder-cell ladder-cell-price">{this.props.price}</div>
        <div className="ladder-cell">
          <NumberBar
            type="ask"
            number={this.props.askAmount}
            maxNumber={this.props.maxAmount}
            maxBarWidth={this.props.maxBarWidth}
          ></NumberBar>
        </div>
      </div>
    )
  }
});

var Ladder = React.createClass({
  getInitialState: function() {

    setInterval(function() {
      this.forceUpdate();
    }.bind(this), THROTTLE + (Math.floor(Math.random() * 120)) - 60);

    return null;

  },
  render: function() {

    var rows = ordersModel.levels.map(function(row, index) {
      return (
        <LadderRow
        price={row.price}
        bidAmount={row.bidVolume}
        askAmount={row.askVolume}
        key={row.key}
        maxBarWidth="120"
        maxAmount={ordersModel.maxVolume}
      /> );
    }.bind(this));

    return (
      <div className='ladder'>
          <header>Apple (AAPL)</header>
          {rows}
      </div>
    );
  }
});

var PriceLevel = function(price, side, throttle) {
  this.price = price;
  this.side = side;
  this.key = PriceLevel.COUNT++;

  this.bidVolume = (side === "bid") ? Math.floor(Math.random() * 400) + 100 : "";
  this.askVolume = (side === "ask") ? Math.floor(Math.random() * 400) + 100 : "";

  this._generate();
  setInterval(this._generate.bind(this), throttle);
};
PriceLevel.COUNT = 0;

PriceLevel.prototype._generate = function() {
  var volumeDifference = Math.floor(Math.random() * 200) - 100;

  if (this.side === "bid") {
    var volume = this.bidVolume + volumeDifference;
    if (volume < 100) {
      volume = 100;
    } else if (volume > 500) {
      volume = 500;
    }
    this.bidVolume = volume;
  } else {
    var volume = this.askVolume + volumeDifference;
    if (volume < 100) {
      volume = 100;
    } else if (volume > 500) {
      volume = 500;
    }
    this.askVolume = volume;
  }

};

var OrdersModel = function() {
  this.levels = [];

  var depth = 10;
  var market = Math.floor(depth / 2) - 1;
  this.priceStart = Big(Math.random() + 1);
  this.priceStep = 0.00001;
  var throttleMin = 50;
  var throttleStep = 200;
  var price = this.priceStart;

  for (var i = 0; i < depth; i++) {

    var marketDistance = Math.abs(market - i);
    var throttle = throttleMin + (throttleStep * marketDistance);
    var diff = Number((i * this.priceStep).toFixed(5));
    price = (Number(price) - diff).toFixed(5);
    var side = (i > market) ? "ask" : "bid";

    this.levels.push(new PriceLevel(price, side, throttle));
  };

  this.maxVolume = 500;

  window.setInterval(this._moveMarket.bind(this), Math.floor(Math.random() * 700) + 400);
};

OrdersModel.prototype._moveMarket = function() {
  var multiplier = (Math.random() > 0.5) ? 1 : -1;
  this.priceStart = Big(this.priceStart).plus(Big(this.priceStep).times(multiplier));

  var priceStep = new Big(this.priceStep);
  var price = Big(this.priceStart);

  for (var i = 0; i < this.levels.length; i++) {
    price = Big(price.minus(priceStep));
    this.levels[i].price = price.toFixed(5).toString();
  };
};

var ordersModel = new OrdersModel();

for (var i = 0; i < NUMBER_OF_LADDERS; i++) {
  var holder = document.createElement("div");
  holder.className = "component";
  React.renderComponent(Ladder(), holder);
  document.body.appendChild(holder);
}

document.body.classList.add("transitions");

document.querySelector(".transition-control input").addEventListener("click", function() {
  document.body.classList.toggle("transitions");
})
    //@ sourceURL=pen.js
  </script>

</body>

</html>
