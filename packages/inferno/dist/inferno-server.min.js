!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r(require("stream")):"function"==typeof define&&define.amd?define(["stream"],r):e.InfernoServer=r(e.stream)}(this,function(e){"use strict";function r(e){return e instanceof Array}function t(e){var r=e.type;return!l(r.prototype)&&!l(r.prototype.render)}function n(e){return u(e)||s(e)}function o(e){return l(e)||a(e)}function i(e){return a(e)||e===!1||p(e)||l(e)}function u(e){return"string"==typeof e}function s(e){return"number"==typeof e}function a(e){return null===e}function p(e){return e===!0}function l(e){return void 0===e}function c(e,r,t){e.split(",").forEach(function(e){return r[e]=t})}function d(e){return(e+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replace(/\//g,"&#x2F;")}function f(e){return(e+"").replace(/&/g,"&amp;").replace(/"/g,"&quot;")}function h(e){return e.replace(/([a-zA-Z])(?=[A-Z])/g,"$1-").toLowerCase()}function v(e){return!!q[e]}function m(e,r,t,n,o,i){return{children:t,childrenType:i||Z,dom:null,key:n,nodeType:z,props:r,ref:o||null,tag:e}}function y(e){var r=e.bp,t=r.staticVElement,n=m(t.tag,null,null,e.key,null,null),o=r.v0,i=t.children,u=t.props;if(a(i)||(n.children=i),a(u)||(n.props=u),!a(o)){g(n,e,o,e.v0,r.d0);var s=r.v1;if(!a(s)){g(n,e,s,e.v1,r.d1);var p=r.v2;if(!a(p)){g(n,e,p,e.v2,r.d2);var l=r.v3;if(!a(l))for(var c=e.v3,d=r.d3,f=r.v3,h=0;h<f.length;h++)g(n,e,f[h],c[h],d[h])}}}return n}function g(e,r,t,n,i){switch(t){case U:e.childrenType=i,o(e.children)&&(e.children=n);break;case X:e.props?e.props.className=n:e.props={className:n};break;case J:e.props||(e.props={}),e.props["data-"+i]=n;break;case $:e.props?e.props.style=n:e.props={style:n};break;case Y:e.props?e.props.value=n:e.props={value:n};break;case ee:e.props||(e.props={}),e.props[i]=n;break;case K:e.ref=n;break;case Q:e.props||(e.props=n);break;default:throw new Error("Unknown ValueType: "+t)}}function k(e,r,n){var i=e.type,u=e.props;if(t(e)){var s=new i(u),a=s.getChildContext();o(a)||(n=Object.assign({},n,a)),s.context=n,s._pendingSetState=!0,s.componentWillMount();var p=s.render(u,e.context);return s._pendingSetState=!1,_(p,n,r)}return _(i(u,n),n,r)}function w(e,t){if(e&&r(e)){for(var o=[],u=!1,s=0;s<e.length;s++){var a=e[s],p=n(a);i(a)?o.push("<!--!-->"):p?(u&&o.push("<!---->"),p&&o.push(d(a)),u=!0):r(a)?(o.push("<!---->"),o.push(w(a,t)),o.push("<!--!-->"),u=!0):(u=!1,o.push(_(a,t,!1)))}return o.join("")}return i(e)?"":n(e)?d(e):_(e,t,!1)||""}function b(e){if(n(e))return e;for(var r=[],t=Object.keys(e),i=0;i<t.length;i++){var u=t[i],a=e[u],p=s(a)&&!W[u]?"px":"";o(a)||r.push(h(u)+":"+f(a)+p+";")}return r.join("")}function x(e,r,t){for(var o=e.tag,i=[],u=e.props,s=u&&Object.keys(u)||[],a="",l=0;l<s.length;l++){var c=s[l],d=u[c];"dangerouslySetInnerHTML"===c?a=d.__html:"style"===c?i.push('style="'+b(u.style)+'"'):"className"===c?i.push('class="'+d+'"'):n(d)?i.push(f(c)+'="'+f(d)+'"'):p(d)&&i.push(f(c))}return r&&i.push("data-infernoroot"),v(o)?"<"+o+(i.length>0?" "+i.join(" "):"")+">":"<"+o+(i.length>0?" "+i.join(" "):"")+">"+(a||w(e.children,t))+"</"+o+">"}function S(e,r,t){return _(y(e),t,r)}function _(e,r,t){switch(e.nodeType){case F:return S(e,t,r);case V:return k(e,t,r);case z:return x(e,t,r);case G:case R:case D:default:throw Error("Inferno Error: Bad input argument called on renderInputToString(). Input argument may need normalising.")}}function N(e){return _(e,null,!0)}function C(e){return _(e,null,!1)}function M(e){if(n(e))return e;for(var r=[],t=Object.keys(e),i=0;i<t.length;i++){var u=t[i],a=e[u],p=s(a)&&!W[u]?"px":"";o(a)||r.push(h(u)+":"+f(a)+p+";")}return r.join()}function j(e){var r=[],t=e&&Object.keys(e)||[];return t.forEach(function(t,o){var i=e[t];switch(t){case"dangerouslySetInnerHTML":case"className":case"style":return;default:n(i)?r.push(f(t)+'="'+f(i)+'"'):p(i)&&r.push(f(t))}}),r}function O(e){return new re(e,!1)}function T(e){return new re(e,!0)}var I="undefined"!=typeof window&&window.document,E="http://www.w3.org/1999/xlink",L="http://www.w3.org/XML/1998/namespace",P={},A={},H={},W={};c("xlink:href,xlink:arcrole,xlink:actuate,xlink:role,xlink:titlef,xlink:type",H,E),c("xml:base,xml:lang,xml:space",H,L),c("volume,value,defaultValue,defaultChecked",P,!0),c("muted,scoped,loop,open,checked,default,capture,disabled,selected,readonly,multiple,required,autoplay,controls,seamless,reversed,allowfullscreen,novalidate",A,!0),c("animationIterationCount,borderImageOutset,borderImageSlice,borderImageWidth,boxFlex,boxFlexGroup,boxOrdinalGroup,columnCount,flex,flexGrow,flexPositive,flexShrink,flexNegative,flexOrder,gridRow,gridColumn,fontWeight,lineClamp,lineHeight,opacity,order,orphans,tabSize,widows,zIndex,zoom,fillOpacity,floodOpacity,stopOpacity,strokeDasharray,strokeDashoffset,strokeMiterlimit,strokeOpacity,strokeWidth,",W,!0);var q={area:!0,base:!0,br:!0,col:!0,command:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},z=1,F=2,G=3,R=4,V=6,D=7,Z=5,B=function(){this._listeners=[]};B.prototype.addListener=function(e){this._listeners.push(e)},B.prototype.trigger=function(){for(var e=this,r=0;r<this._listeners.length;r++)e._listeners[r]()};var U=1,X=2,$=3,J=4,K=5,Q=6,Y=7,ee=8,re=(new Map,new Map,new Map,I?document.body:null,function(e){function u(r,t){e.call(this),this.started=!1,this.initNode=r,this.staticMarkup=t}return e&&(u.__proto__=e),u.prototype=Object.create(e&&e.prototype),u.prototype.constructor=u,u.prototype._read=function(){var e=this;this.started||(this.started=!0,Promise.resolve().then(function(){return e.renderNode(e.initNode,null,e.staticMarkup)}).then(function(){e.push(null)}).catch(function(r){e.emit("error",r)}))},u.prototype.renderNode=function(e,r,t){if(!i(e))return e.nodeType===V?this.renderComponent(e,t,r):e.nodeType===z?this.renderNative(e,t,r):void 0},u.prototype.renderComponent=function(e,r,n){var i=this,u=e.type,s=e.props;if(!t(e))return this.renderNode(u(s),n,r);var a=new u(s),p=a.getChildContext();return o(p)||(n=Object.assign({},n,p)),a.context=n,a._pendingSetState=!0,Promise.resolve(a.componentWillMount()).then(function(){var e=a.render();return a._pendingSetState=!1,i.renderNode(e,n,r)})},u.prototype.renderChildren=function(e,t){var o=this;if(n(e))return this.push(d(e));if(e){var u=r(e);if(!u&&!i(e))return this.renderNode(e,t,!1);if(!u)throw new Error("invalid component");return e.reduce(function(e,u){return e.then(function(e){var s=n(u),a=i(u);return s||a?(e===!0&&(a?o.push("<!--!-->"):o.push("<!---->")),s&&o.push(d(u)),!0):r(u)?(o.push("<!---->"),Promise.resolve(o.renderChildren(u)).then(function(){return o.push("<!--!-->"),!0})):o.renderNode(u,t,!1).then(function(){return!1})})},Promise.resolve(!1))}},u.prototype.renderNative=function(e,r,t){var n=this,o=e.tag,i=e.props,u=j(i),s="";if(i){var a=i.className;a&&u.push('class="'+f(a)+'"');var p=i.style;p&&u.push('style="'+M(p)+'"'),i.dangerouslySetInnerHTML&&(s=i.dangerouslySetInnerHTML.__html)}if(r&&u.push("data-infernoroot"),this.push("<"+o+(u.length>0?" "+u.join(" "):"")+">"),!v(o))return s?(this.push(s),void this.push("</"+o+">")):Promise.resolve(this.renderChildren(e.children,t)).then(function(){n.push("</"+o+">")})},u}(e.Readable)),te={renderToString:N,renderToStaticMarkup:C,streamAsString:O,streamAsStaticMarkup:T,RenderStream:re};return te});
