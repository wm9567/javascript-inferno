!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r(require("stream")):"function"==typeof define&&define.amd?define(["stream"],r):(e.Inferno=e.Inferno||{},e.Inferno.Server=r(e.stream))}(this,function(e){"use strict";function r(e){return o(e)||i(e)}function t(e){return s(e)||u(e)}function n(e){return u(e)||e===!1||a(e)||s(e)}function o(e){return"string"==typeof e}function i(e){return"number"==typeof e}function u(e){return null===e}function a(e){return e===!0}function s(e){return void 0===e}function l(e){throw e||(e=w),new Error("Inferno Error: "+e)}function c(e,r,t){e.split(",").forEach(function(e){return r[e]=t})}function f(e){for(var r=e+"",t=r.length,n="",o=0;o<t;o++)switch(r.charCodeAt(o)){case 38:n+="&amp;";break;case 34:n+="&quot;";break;case 60:n+="&lt;";break;case 62:n+="&gt;";break;default:n+=r[o]}return n}function d(e){return e.replace(/([a-zA-Z])(?=[A-Z])/g,"$1-").toLowerCase()}function p(e){return!!j[e]}function h(e){if(r(e))return e;var n="";for(var o in e){var u=e[o],a=i(u)&&!O[o]?"px":"";t(u)||(n+=d(o)+":"+f(u)+a+";")}return n}function m(e,o,i){var s=e.flags,c=e.props,d=e.type,v=e.children;if(28&s){var y=4&s;if(y){var g=new d(c),x=g.getChildContext();t(x)||(o=Object.assign({},o,x)),g.context=o,g._pendingSetState=!0,g.componentWillMount();var k=g.render(c,e.context);return g._pendingSetState=!1,m(k,o,!0)}return m(d(c,o),o,!0)}if(3970&s){var b,w="<"+d,C=p(d);if(!u(c))for(var I in c){var _=c[I];"dangerouslySetInnerHTML"===I?b=_.__html:"style"===I?w+=' style="'+h(c.style)+'"':"className"===I?w+=' class="'+f(_)+'"':r(_)?w+=" "+I+'="'+f(_)+'"':a(_)&&(w+=' "'+I+'"')}if(C)w+=">";else{if(w+=">",n(v))b&&(w+=b);else if(S(v))for(var M=0;M<v.length;M++)w+=m(v[M],o,0===M);else w+=r(v)?f(v):m(v,o,!0);C||(w+="</"+d+">")}return w}return 1&s?(i?"":"<!---->")+f(v):void l()}function v(e){return m(e,null,!0)}function y(e){return m(e,null,!0)}function g(e){if(r(e))return e;for(var n=[],o=Object.keys(e),u=0;u<o.length;u++){var a=o[u],s=e[a],l=i(s)&&!O[a]?"px":"";t(s)||n.push(d(a)+":"+f(s)+l+";")}return n.join()}function x(e){var t=[],n=e&&Object.keys(e)||[];return n.forEach(function(n,o){var i=e[n];switch(n){case"dangerouslySetInnerHTML":case"className":case"style":return;default:r(i)?t.push(f(n)+'="'+f(i)+'"'):a(i)&&t.push(f(n))}}),t}function k(e){return new T(e,!1)}function b(e){return new T(e,!0)}var w="a runtime error occured! Use Inferno in development environment to find the error.",S=Array.isArray,C="http://www.w3.org/1999/xlink",I="http://www.w3.org/XML/1998/namespace",_={},M={},N={},O={};c("xlink:href,xlink:arcrole,xlink:actuate,xlink:role,xlink:titlef,xlink:type",N,C),c("xml:base,xml:lang,xml:space",N,I),c("volume,defaultValue,defaultChecked",_,!0),c("muted,scoped,loop,open,checked,default,capture,disabled,readonly,required,autoplay,controls,seamless,reversed,allowfullscreen,novalidate",M,!0),c("animationIterationCount,borderImageOutset,borderImageSlice,borderImageWidth,boxFlex,boxFlexGroup,boxOrdinalGroup,columnCount,flex,flexGrow,flexPositive,flexShrink,flexNegative,flexOrder,gridRow,gridColumn,fontWeight,lineClamp,lineHeight,opacity,order,orphans,tabSize,widows,zIndex,zoom,fillOpacity,floodOpacity,stopOpacity,strokeDasharray,strokeDashoffset,strokeMiterlimit,strokeOpacity,strokeWidth,",O,!0);var j={area:!0,base:!0,br:!0,col:!0,command:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},T=function(e){function o(r,t){e.call(this),this.started=!1,this.initNode=r,this.staticMarkup=t}return e&&(o.__proto__=e),o.prototype=Object.create(e&&e.prototype),o.prototype.constructor=o,o.prototype._read=function(){var e=this;this.started||(this.started=!0,Promise.resolve().then(function(){return e.renderNode(e.initNode,null,e.staticMarkup)}).then(function(){e.push(null)}).catch(function(r){e.emit("error",r)}))},o.prototype.renderNode=function(e,r,t){if(!n(e)){var o=e.flags;return 28&o?this.renderComponent(e,t,r,4&o):3970&o?this.renderElement(e,t,r):this.renderText(e,t,r)}},o.prototype.renderComponent=function(e,r,n,o){var i=this,u=e.type,a=e.props;if(!o)return this.renderNode(u(a),n,r);var s=new u(a),l=s.getChildContext();return t(l)||(n=Object.assign({},n,l)),s.context=n,s._pendingSetState=!0,Promise.resolve(s.componentWillMount()).then(function(){var e=s.render();return s._pendingSetState=!1,i.renderNode(e,n,r)})},o.prototype.renderChildren=function(e,t){var o=this;if(r(e))return this.push(f(e));if(e){var i=S(e);if(!i&&!n(e))return this.renderNode(e,t,!1);if(!i)throw new Error("invalid component");return e.reduce(function(e,i){return e.then(function(e){var u=r(i),a=n(i);return u||a?(e===!0&&(a?o.push("<!--!-->"):o.push("<!---->")),u&&o.push(f(i)),!0):S(i)?(o.push("<!---->"),Promise.resolve(o.renderChildren(i)).then(function(){return o.push("<!--!-->"),!0})):(1&i.flags&&(e&&o.push("<!---->"),e=!0),o.renderNode(i,t,!1).then(function(e){return!!(1&i.flags)}))})},Promise.resolve(!1))}},o.prototype.renderText=function(e,r,t){var n=this;return Promise.resolve().then(function(r){return n.push(e.children),r})},o.prototype.renderElement=function(e,r,t){var n=this,o=e.type,i=e.props,u=x(i),a="";if(i){var s=i.className;s&&u.push('class="'+f(s)+'"');var l=i.style;l&&u.push('style="'+g(l)+'"'),i.dangerouslySetInnerHTML&&(a=i.dangerouslySetInnerHTML.__html)}if(r&&u.push("data-infernoroot"),this.push("<"+o+(u.length>0?" "+u.join(" "):"")+">"),!p(o))return a?(this.push(a),void this.push("</"+o+">")):Promise.resolve(this.renderChildren(e.children,t)).then(function(){n.push("</"+o+">")})},o}(e.Readable),A={renderToString:v,renderToStaticMarkup:y,streamAsString:k,streamAsStaticMarkup:b,RenderStream:T};return A});
