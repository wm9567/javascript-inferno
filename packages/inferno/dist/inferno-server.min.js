!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r(require("./inferno"),require("stream")):"function"==typeof define&&define.amd?define(["inferno","stream"],r):(e.Inferno=e.Inferno||{},e.Inferno.Server=r(e.Inferno,e.stream))}(this,function(e,r){"use strict";function n(e){for(var r=e+"",n=r.length,t="",o=0;o<n;o++)switch(r.charCodeAt(o)){case 38:t+="&amp;";break;case 39:t+="&#039;";break;case 34:t+="&quot;";break;case 60:t+="&lt;";break;case 62:t+="&gt;";break;default:t+=r[o]}return t}function t(e){return e.replace(M,"-$&").toLowerCase().replace(I,"-ms-")}function o(e){return!!_[e]}function i(e){return l(e)||c(e)}function u(e){return d(e)||f(e)}function a(e){return f(e)||e===!1||p(e)||d(e)}function s(e){return"function"==typeof e}function l(e){return"string"==typeof e}function c(e){return"number"==typeof e}function f(e){return null===e}function p(e){return e===!0}function d(e){return void 0===e}function h(e){throw e||(e=O),new Error("Inferno Error: "+e)}function m(e,r){for(var n in e)d(r[n])&&(r[n]=e[n])}function v(e,r,n){e.split(",").forEach(function(e){return r[e]=n})}function y(e){if(i(e))return e;var r="";for(var o in e){var a=e[o],s=c(a)&&!L[o]?"px":"";u(a)||(r+=t(o)+":"+n(a)+s+";")}return r}function g(r,t,l){var c=r.flags,d=r.type,v=r.props||e.EMPTY_OBJ,x=r.children;if(28&c){var k=4&c;if(u(d.defaultProps)||(m(d.defaultProps,v),r.props=v),k){var b=new d(v,t),w=b.getChildContext();u(w)||(t=Object.assign({},t,w)),b.context=t,b._pendingSetState=!0,s(b.componentWillMount)&&b.componentWillMount();var S=b.render(v,r.context);return b._pendingSetState=!1,S?g(S,t,!0):""}return g(d(v,t),t,!0)}if(3970&c){var C,M="<"+d,I=o(d);if(!f(v))for(var _ in v){var O=v[_];"dangerouslySetInnerHTML"===_?C=O.__html:"style"===_?M+=' style="'+y(v.style)+'"':"className"!==_||u(O)?i(O)?M+=" "+_+'="'+n(O)+'"':p(O)&&(M+=" "+_):M+=' class="'+n(O)+'"'}if(I)M+=">";else{if(M+=">",a(x))C&&(M+=C);else if(N(x))for(var P=0;P<x.length;P++){var T=x[P];a(T)||(M+=g(T,t,0===P))}else M+=i(x)?n(x):g(x,t,!0);I||(M+="</"+d+">")}return M}return 1&c?(l?"":"<!---->")+n(x):void h()}function x(e){return g(e,{},!0)}function k(e){return g(e,{},!0)}function b(e){if(i(e))return e;var r=[];for(var o in e){var a=e[o],s=c(a)&&!L[o]?"px":"";u(a)||r.push(t(o)+":"+n(a)+s+";")}return r.join()}function w(e){var r=[],t=e&&Object.keys(e)||[];return t.forEach(function(t,o){var u=e[t];switch(t){case"dangerouslySetInnerHTML":case"className":case"style":return;default:i(u)?r.push(n(t)+'="'+n(u)+'"'):p(u)&&r.push(n(t))}}),r}function S(e){return new H(e,!1)}function C(e){return new H(e,!0)}var M=/[A-Z]/g,I=/^ms-/,_={area:!0,base:!0,br:!0,col:!0,command:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},O="a runtime error occured! Use Inferno in development environment to find the error.",N=Array.isArray,P="http://www.w3.org/1999/xlink",T="http://www.w3.org/XML/1998/namespace",E={},j={},A={},L={},W={},D={};v("xlink:href,xlink:arcrole,xlink:actuate,xlink:role,xlink:titlef,xlink:type",A,P),v("xml:base,xml:lang,xml:space",A,T),v("volume,defaultValue,defaultChecked",E,!0),v("children,ref,key,selected,checked,value,multiple",W,!0),v("onClick,onMouseDown,onMouseUp,onMouseMove,onSubmit,onDblClick,onKeyDown,onKeyUp,onKeyPress",D,!0),v("muted,scoped,loop,open,checked,default,capture,disabled,readOnly,required,autoplay,controls,seamless,reversed,allowfullscreen,novalidate",j,!0),v("animationIterationCount,borderImageOutset,borderImageSlice,borderImageWidth,boxFlex,boxFlexGroup,boxOrdinalGroup,columnCount,flex,flexGrow,flexPositive,flexShrink,flexNegative,flexOrder,gridRow,gridColumn,fontWeight,lineClamp,lineHeight,opacity,order,orphans,tabSize,widows,zIndex,zoom,fillOpacity,floodOpacity,stopOpacity,strokeDasharray,strokeDashoffset,strokeMiterlimit,strokeOpacity,strokeWidth,",L,!0);var H=function(e){function r(r,n){e.call(this),this.started=!1,this.initNode=r,this.staticMarkup=n}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r.prototype._read=function(){var e=this;this.started||(this.started=!0,Promise.resolve().then(function(){return e.renderNode(e.initNode,null,e.staticMarkup)}).then(function(){e.push(null)}).catch(function(r){e.emit("error",r)}))},r.prototype.renderNode=function(e,r,n){if(!a(e)){var t=e.flags;return 28&t?this.renderComponent(e,n,r,4&t):3970&t?this.renderElement(e,n,r):this.renderText(e,n,r)}},r.prototype.renderComponent=function(e,r,n,t){var o=this,i=e.type,a=e.props;if(!t)return this.renderNode(i(a),n,r);var s=new i(a),l=s.getChildContext();return u(l)||(n=Object.assign({},n,l)),s.context=n,s._pendingSetState=!0,Promise.resolve(s.componentWillMount()).then(function(){var e=s.render();return s._pendingSetState=!1,o.renderNode(e,n,r)})},r.prototype.renderChildren=function(e,r){var t=this;if(i(e))return this.push(n(e));if(e){var o=N(e);if(!o&&!a(e))return this.renderNode(e,r,!1);if(!o)throw new Error("invalid component");return e.reduce(function(e,o){return e.then(function(e){var u=i(o);return u?(e===!0&&t.push("<!---->"),u&&t.push(n(o)),!0):N(o)?(t.push("<!---->"),Promise.resolve(t.renderChildren(o)).then(function(){return t.push("<!--!-->"),!0})):a(o)?void 0:(1&o.flags&&(e&&t.push("<!---->"),e=!0),t.renderNode(o,r,!1).then(function(e){return!!(1&o.flags)}))})},Promise.resolve(!1))}},r.prototype.renderText=function(e,r,n){var t=this;return Promise.resolve().then(function(r){return t.push(e.children),r})},r.prototype.renderElement=function(e,r,t){var i=this,a=e.type,s=e.props,l=w(s),c="";if(s){var f=s.className;u(f)||l.push('class="'+n(f)+'"');var p=s.style;p&&l.push('style="'+b(p)+'"'),s.dangerouslySetInnerHTML&&(c=s.dangerouslySetInnerHTML.__html)}if(r&&l.push("data-infernoroot"),this.push("<"+a+(l.length>0?" "+l.join(" "):"")+">"),!o(a))return c?(this.push(c),void this.push("</"+a+">")):Promise.resolve(this.renderChildren(e.children,t)).then(function(){i.push("</"+a+">")})},r}(r.Readable),q={renderToString:x,renderToStaticMarkup:k,streamAsString:S,streamAsStaticMarkup:C,RenderStream:H};return q});
