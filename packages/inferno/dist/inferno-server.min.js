!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r(require("stream")):"function"==typeof define&&define.amd?define(["stream"],r):e.InfernoServer=r(e.stream)}(this,function(e){"use strict";function r(e){return e instanceof Array}function n(e){var r=e.component;return!c(r.prototype)&&!c(r.prototype.render)}function t(e){return u(e)||a(e)}function o(e){return c(e)||s(e)}function i(e){return s(e)||e===!1||p(e)||c(e)}function u(e){return"string"==typeof e}function a(e){return"number"==typeof e}function s(e){return null===e}function p(e){return e===!0}function c(e){return void 0===e}function l(e,r,n){e.split(",").forEach(function(e){return r[e]=n})}function f(e){return(e+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replace(/\//g,"&#x2F;")}function d(e){return(e+"").replace(/&/g,"&amp;").replace(/"/g,"&quot;")}function h(e){return e.replace(/([a-zA-Z])(?=[A-Z])/g,"$1-").toLowerCase()}function E(e){return!!W[e]}function P(e){var r=e.bp,n=r.staticVElement,t=m(n.tag,null,null,e.key,null,null),o=r.v0,i=n.children,u=n.props;if(s(i)||(t.children=i),s(u)||(t.props=u),!s(o)){v(t,e,o,e.v0,r.d0);var a=r.v1;if(!s(a)){v(t,e,a,e.v1,r.d1);var p=r.v2;if(!s(p)){v(t,e,p,e.v2,r.d2);var c=r.v3;if(!s(c))for(var l=e.v3,f=r.d3,d=r.v3,h=0;h<d.length;h++)v(t,e,d[h],l[h],f[h])}}}return t}function v(e,r,n,t,i){switch(n){case K.CHILDREN:e.childrenType=i,o(e.children)&&(e.children=t);break;case K.PROP_CLASS_NAME:e.props||(e.props={className:t});break;case K.PROP_DATA:e.props||(e.props={}),e.props["data-"+i]=t;break;case K.PROP_STYLE:e.props||(e.props={style:t});break;case K.PROP_VALUE:e.props||(e.props={value:t});break;case K.PROP:e.props||(e.props={}),e.props[i]=t;break;case K.PROP_REF:e.ref=t;break;case K.PROP_SPREAD:e.props||(e.props=t)}}function m(e,r,n,t,o,i){return{children:n,childrenType:i||Y.UNKNOWN,dom:null,key:t,props:r,ref:o||null,tag:e,type:U.ELEMENT}}function O(e){return e.type===U.ELEMENT}function g(e){return e.type===U.OPT_ELEMENT}function N(e){return e.type===U.COMPONENT}function y(e,r,t){var i=e.component,u=e.props;if(n(e)){var a=new i(u),s=a.getChildContext();o(s)||(t=Object.assign({},t,s)),a.context=t,a._pendingSetState=!0,a.componentWillMount();var p=a.render();return a._pendingSetState=!1,S(p,t,r)}return S(i(u),t,r)}function T(e,n){if(e&&r(e)){for(var o=[],u=!1,a=0;a<e.length;a++){var s=e[a],p=t(s),c=i(s);p||c?(u===!0&&(i(s)?o.push("<!--!-->"):o.push("<!---->")),p&&o.push(f(s)),u=!0):r(s)?(o.push("<!---->"),o.push(T(s)),o.push("<!--!-->"),u=!0):(u=!1,o.push(S(s,n,!1)))}return o.join("")}return i(e)?"":t(e)?f(e):S(e,n,!1)||""}function _(e){if(t(e))return e;for(var r=[],n=Object.keys(e),i=0;i<n.length;i++){var u=n[i],s=e[u],p=a(s)&&!F[u]?"px":"";o(s)||r.push(h(u)+":"+d(s)+p+";")}return r.join()}function R(e,r,n){for(var o=e.tag,i=[],u=e.props,a=u&&Object.keys(u)||[],s="",c=0;c<a.length;c++){var l=a[c],f=u[l];"dangerouslySetInnerHTML"===l?s=f.__html:"style"===l?i.push('style="'+_(u.style)+'"'):"className"===l?i.push('class="'+f+'"'):t(f)?i.push(d(l)+'="'+d(f)+'"'):p(f)&&i.push(d(l))}return r&&i.push("data-infernoroot"),E(o)?"<"+o+(i.length>0?" "+i.join(" "):"")+">":"<"+o+(i.length>0?" "+i.join(" "):"")+">"+(s||T(e.children,n))+"</"+o+">"}function k(e,r,n){return S(P(e),n,r)}function S(e,r,n){if(!i(e)){if(g(e))return k(e,n,r);if(O(e))return R(e,n,r);if(N(e))return y(e,n,r)}throw Error("Inferno Error: Bad input argument called on renderInputToString(). Input argument may need normalising.")}function b(e){return S(e,null,!1)}function x(e){return S(e,null,!0)}function L(e){if(t(e))return e;for(var r=[],n=Object.keys(e),i=0;i<n.length;i++){var u=n[i],s=e[u],p=a(s)&&!F[u]?"px":"";o(s)||r.push(h(u)+":"+d(s)+p+";")}return r.join()}function A(e){var r=[],n=e&&Object.keys(e)||[];return n.forEach(function(n,o){var i=e[n];switch(n){case"dangerouslySetInnerHTML":case"className":case"style":return;default:t(i)?r.push(d(n)+'="'+d(i)+'"'):p(i)&&r.push(d(n))}}),r}function M(e){return new G(e,(!1))}function C(e){return new G(e,(!0))}var w="http://www.w3.org/1999/xlink",D="http://www.w3.org/XML/1998/namespace",I={},j={},H={},F={};l("xlink:href,xlink:arcrole,xlink:actuate,xlink:role,xlink:titlef,xlink:type",H,w),l("xml:base,xml:lang,xml:space",H,D),l("volume,value",I,!0),l("muted,scoped,loop,open,checked,default,capture,disabled,selected,readonly,multiple,required,autoplay,controls,seamless,reversed,allowfullscreen,novalidate",j,!0),l("animationIterationCount,borderImageOutset,borderImageSlice,borderImageWidth,boxFlex,boxFlexGroup,boxOrdinalGroup,columnCount,flex,flexGrow,flexPositive,flexShrink,flexNegative,flexOrder,gridRow,gridColumn,fontWeight,lineClamp,lineHeight,opacity,order,orphans,tabSize,widows,zIndex,zoom,fillOpacity,floodOpacity,stopOpacity,strokeDasharray,strokeDashoffset,strokeMiterlimit,strokeOpacity,strokeWidth,",F,!0);var U,W={area:!0,base:!0,br:!0,col:!0,command:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0};!function(e){e[e.ELEMENT=1]="ELEMENT",e[e.OPT_ELEMENT=2]="OPT_ELEMENT",e[e.TEXT=3]="TEXT",e[e.FRAGMENT=4]="FRAGMENT",e[e.OPT_BLUEPRINT=5]="OPT_BLUEPRINT",e[e.COMPONENT=6]="COMPONENT",e[e.PLACEHOLDER=7]="PLACEHOLDER"}(U||(U={}));var K;!function(e){e[e.CHILDREN=0]="CHILDREN",e[e.PROP_CLASS_NAME=1]="PROP_CLASS_NAME",e[e.PROP_STYLE=2]="PROP_STYLE",e[e.PROP_DATA=3]="PROP_DATA",e[e.PROP_REF=4]="PROP_REF",e[e.PROP_SPREAD=5]="PROP_SPREAD",e[e.PROP_VALUE=6]="PROP_VALUE",e[e.PROP=7]="PROP"}(K||(K={}));var Y;!function(e){e[e.NON_KEYED=0]="NON_KEYED",e[e.KEYED=1]="KEYED",e[e.NODE=2]="NODE",e[e.TEXT=3]="TEXT",e[e.UNKNOWN=4]="UNKNOWN"}(Y||(Y={}));var G=function(e){function u(r,n){e.call(this),this.initNode=r,this.staticMarkup=n,this.started=!1}return e&&(u.__proto__=e),u.prototype=Object.create(e&&e.prototype),u.prototype.constructor=u,u.prototype._read=function(){var e=this;this.started||(this.started=!0,Promise.resolve().then(function(){return e.renderNode(e.initNode,null,e.staticMarkup)}).then(function(){e.push(null)}).catch(function(r){e.emit("error",r)}))},u.prototype.renderNode=function(e,r,n){if(!i(e))return N(e)?this.renderComponent(e,n,r):O(e)?this.renderNative(e,n,r):void 0},u.prototype.renderComponent=function(e,r,t){var i=this,u=e.component,a=e.props;if(!n(e))return this.renderNode(u(a),t,r);var s=new u(a),p=s.getChildContext();return o(p)||(t=Object.assign({},t,p)),s.context=t,s._pendingSetState=!0,Promise.resolve(s.componentWillMount()).then(function(){var e=s.render();return s._pendingSetState=!1,i.renderNode(e,t,r)})},u.prototype.renderChildren=function(e,n){var o=this;if(t(e))return this.push(f(e));if(e){var u=r(e);if(!u&&!i(e))return this.renderNode(e,n,!1);if(!u)throw new Error("invalid component");return e.reduce(function(e,u){return e.then(function(e){var a=t(u),s=i(u);return a||s?(e===!0&&(s?o.push("<!--!-->"):o.push("<!---->")),a&&o.push(f(u)),!0):r(u)?(o.push("<!---->"),Promise.resolve(o.renderChildren(u)).then(function(){return o.push("<!--!-->"),!0})):o.renderNode(u,n,!1).then(function(){return!1})})},Promise.resolve(!1))}},u.prototype.renderNative=function(e,r,n){var t=this,o=e.tag,i=e.props,u=A(i),a="";if(i){var s=i.className;s&&u.push('class="'+d(s)+'"');var p=i.style;p&&u.push('style="'+L(p)+'"'),i.dangerouslySetInnerHTML&&(a=i.dangerouslySetInnerHTML.__html)}if(r&&u.push("data-infernoroot"),this.push("<"+o+(u.length>0?" "+u.join(" "):"")+">"),!E(o))return a?(this.push(a),void this.push("</"+o+">")):Promise.resolve(this.renderChildren(e.children,n)).then(function(){t.push("</"+o+">")})},u}(e.Readable),X={renderToString:b,renderToStaticMarkup:x,streamAsString:M,streamAsStaticMarkup:C,RenderStream:G};return X});