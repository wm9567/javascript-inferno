!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):t.InfernoRouter=n()}(this,function(){"use strict";function t(t){return t instanceof Array}function n(t){return o(t)||e(t)}function e(t){return null===t}function o(t){return void 0===t}function r(t){return new N(t)}function i(t){return new C(t)}function s(){return new U}function p(){return document.activeElement}function u(t){t!==document.body&&document.activeElement!==t&&t.focus()}function a(t,n,e){for(var o in n)t._pendingState[o]=n[o];t._pendingSetState?(t.state=Object.assign({},t.state,t._pendingState),t._pendingState={}):(t._pendingSetState=!0,c(t,!1,e))}function c(t,e,o){if((!t._deferSetState||e)&&!t._blockRender){t._pendingSetState=!1;var r=t._pendingState,i=t.state,a=Object.assign({},i,r),c=t.props;t._pendingState={};var h=t._updateComponent(i,a,c,c,e);h===NO_RENDER?h=t._lastInput:n(h)&&(h=s());var l=t._lastInput,d=l._dom.parentNode,f=p(),_=new M;t._patch(l,h,d,_,t.context,t,null),t._lastInput=h,t._componentToDOMNodeMap.set(t,h.dom),t.componentDidUpdate(c,i),_.trigger(),n(o)||o(),u(f)}}function h(t){return l(t).split("/")}function l(t){return t.replace(/(^\/+|\/+$)/g,"")}function d(t){if(-1===t.indexOf("#"))t="/";else{var n=t.split("#!");n.shift(),t=n.join("")}return t}function f(t,n,e){void 0===e&&(e=W);var o,r=/(?:\?([^#]*))?(#.*)?$/,i=t.match(r),s={};if(i&&i[1])for(var p=i[1].split("&"),u=0;u<p.length;u++){var a=p[u].split("=");s[decodeURIComponent(a[0])]=decodeURIComponent(a.slice(1).join("="))}t=h(t.replace(r,"")),n=h(n||"");for(var c=Math.max(t.length,n.length),l=!1,d=0;c>d;d++)if(n[d]&&":"===n[d].charAt(0)){var f=n[d].replace(/(^\:|[+*?]+$)/g,""),_=(n[d].match(/[+*?]+$/)||W)[0]||"",y=~_.indexOf("+"),m=~_.indexOf("*"),g=t[d]||"";if(!g&&!m&&(_.indexOf("?")<0||y)){o=!1;break}if(s[f]=decodeURIComponent(g),y||m){s[f]=t.slice(d).map(decodeURIComponent).join("/");break}}else if(n[d]!==t[d]&&!l){if("*"!==n[d]||n.length!==d+1){o=!1;break}l=!0}return e.default!==!0&&o===!1?!1:s}function _(t,n){var e=t.attrs||W,o=n.attrs||W,r=y(o.path)-y(e.path);return r||o.path.length-e.path.length}function y(t){return(l(t).match(/\/+/g)||"").length}function m(n){return t(n)?n:n?[n]:n}function g(t,n,o,i,s){t.sort(_);for(var p=0;p<t.length;p++){var u=t[p],a=u.props,c=a.path,h=s+c,l=f(o?d(n):n,h),y=m(u.children);if(y){var v=g(y,n,o,i,h);if(!e(v))return v}if(l)return i?r(i).setProps({params:l,children:u}):u.setProps(Object.assign({},{params:l},u.props))}return!s&&i?r(i):null}function v(t,n){var e=t.to,o=t.children,r=n.hashbang,s=n.history;return i("a").setProps({href:r?s.getHashbangRoot()+d("#!"+e):e}).setChildren(o)}function S(){var t="undefined"!=typeof location?location:EMPTY;return""+(t.pathname||"")+(t.search||"")+(t.hash||"")}function E(){var t="undefined"!=typeof location?location:EMPTY;return""+(t.protocol+"//"||"")+(t.host||"")+(t.pathname||"")+(t.search||"")+"#!"}function R(t){for(var n=!1,e=0;e<x.length;e++)x[e].routeTo(t)===!0&&(n=!0);return n}var b="NO_OP",O="undefined"!=typeof window&&window.document,k={KEYED_LIST:0,NON_KEYED_LIST:1,TEXT:2,NODE:3,UNKNOWN:4},T={ELEMENT:0,COMPONENT:1,TEMPLATE:2,TEXT:3,PLACEHOLDER:4,FRAGMENT:5,VARIABLE:6},C=function(t){this._type=T.ELEMENT,this._dom=null,this._tag=t,this._children=null,this._key=null,this._props=null,this._hooks=null,this._childrenType=k.UKNOWN};C.prototype.children=function t(t){return this._children=t,this},C.prototype.key=function t(t){return this._key=t,this},C.prototype.props=function t(t){return this._props=t,this},C.prototype.hooks=function t(t){return this._hooks=t,this},C.prototype.events=function t(t){return this._events=t,this},C.prototype.childrenType=function t(t){return this._childrenType=t,this};var N=function(t){this._type=T.COMPONENT,this._dom=null,this._component=t,this._props=null,this._hooks=null,this._key=null,this._isStateful=!o(t.prototype)&&!o(t.prototype.render)};N.prototype.key=function t(t){return this._key=t,this},N.prototype.props=function t(t){return this._props=t,this},N.prototype.hooks=function t(t){return this._hooks=t,this};var U=function(){this._type=T.PLACEHOLDER,this._dom=null},M=function(){this._listeners=[]};M.prototype.addListener=function(t){this._listeners.push(t)},M.prototype.trigger=function(){for(var t=this,n=0;n<this._listeners.length;n++)t._listeners[n]()};var j="Inferno Error: Can only update a mounted or mounting component. This usually means you called setState() or forceUpdate() on an unmounted component. This is a no-op.",w=function(t,n){this.props=t||{},this.state={},this.refs={},this._blockRender=!1,this._blockSetState=!1,this._deferSetState=!1,this._pendingSetState=!1,this._pendingState={},this._lastInput=null,this._unmounted=!0,this.context=n||{},this._patch=null,this._parentComponent=null,this._componentToDOMNodeMap=null};w.prototype.render=function(){},w.prototype.forceUpdate=function(t){if(this._unmounted)throw Error(j);c(this,!0,t)},w.prototype.setState=function(t,n){if(this._unmounted)throw Error(j);if(this._blockSetState!==!1)throw Error("Inferno Warning: Cannot update state via setState() in componentWillUpdate()");a(this,t,n)},w.prototype.componentDidMount=function(){},w.prototype.componentWillMount=function(){},w.prototype.componentWillUnmount=function(){},w.prototype.componentDidUpdate=function(){},w.prototype.shouldComponentUpdate=function(){return!0},w.prototype.componentWillReceiveProps=function(){},w.prototype.componentWillUpdate=function(){},w.prototype.getChildContext=function(){},w.prototype._updateComponent=function(t,e,o,r,i){if(this._unmounted===!0)return this._unmounted=!1,!1;if(!n(r)&&n(r.children)&&(r.children=o.children),o!==r||t!==e||i){o!==r&&(this._blockRender=!0,this.componentWillReceiveProps(r),this._blockRender=!1,this._pendingSetState&&(e=Object.assign({},e,this._pendingState),this._pendingSetState=!1,this._pendingState={}));var s=this.shouldComponentUpdate(r,e);if(s!==!1||i)return this._blockSetState=!0,this.componentWillUpdate(r,e),this._blockSetState=!1,this.props=r,this.state=e,this.render()}return b};var I={pending:"pending",fulfilled:"fulfilled",rejected:"rejected"},P=function(t){function n(n){t.call(this,n),this.state={async:null}}return t&&(n.__proto__=t),n.prototype=Object.create(t&&t.prototype),n.prototype.constructor=n,n.prototype.async=function t(){var n=this,t=this.props.async;t&&(this.setState({async:{status:I.pending}}),t(this.props.params).then(function(t){n.setState({async:{status:I.fulfilled,value:t}})},this.reject).catch(this.reject))},n.prototype.reject=function(t){this.setState({async:{status:I.rejected,value:t}})},n.prototype.componentWillReceiveProps=function(){this.async()},n.prototype.componentWillMount=function(){this.async()},n.prototype.render=function(){var t=this.props,n=t.component,e=t.params;return r(n).setProps({params:e,async:this.state.async})},n}(w),W={},L=function(t){function n(n){if(t.call(this,n),!n.history)throw new Error('Inferno Error: "inferno-router" Router components require a "history" prop passed.');this._didRoute=!1,this.state={url:n.url||n.history.getCurrentUrl()}}return t&&(n.__proto__=t),n.prototype=Object.create(t&&t.prototype),n.prototype.constructor=n,n.prototype.getChildContext=function(){return{history:this.props.history,hashbang:this.props.hashbang}},n.prototype.componentWillMount=function(){this.props.history.addRouter(this)},n.prototype.componentWillUnmount=function(){this.props.history.removeRouter(this)},n.prototype.routeTo=function(t){return this._didRoute=!1,this.setState({url:t}),this._didRoute},n.prototype.render=function(){var t=m(this.props.children),n=this.props.url||this.state.url,e=this.props.component,o=this.props.hashbang;return g(t,n,o,e,"")},n}(w),x=[];O&&window.addEventListener("popstate",function(){return R(S())});var D={addRouter:function(t){x.push(t)},removeRouter:function(t){x.splice(x.indexOf(t),1)},getCurrentUrl:S,getHashbangRoot:E},A={Route:P,Router:L,Link:v,browserHistory:D};return A});