<html>
<head>
  <title>Ladders Demo with Inferno</title>
  <link rel='stylesheet prefetch' href='http://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700'>
  <link rel='stylesheet prefetch' href='http://boomtownroi.github.io/boomstrap/css/boomstrap.css'>
  <style>
    * {
      box-sizing: border-box;
    }
    html,
    body {
      margin: 0;
      padding: 0;
    }
    body {
      background-color: #455A64;
      color: #212121;
      font-family: Verdana;
      font-size: 11px;
      padding-bottom: 100px;
    }
    .ladder-row {
      display: table-row;
    }
    .ladder-cell {
      display: table-cell;
      width: 120px;
      position: relative;
      height: 24px;
      padding: 0;
      line-height: 24px;
      vertical-align: top;
      text-align: center;
    }
    .ladder-cell-price {
      background-color: rgba(0, 0, 0, 0.05);
    }
    .component {
      display: inline-block;
      margin: 14px 0 0 14px;
      background-color: #fff;
    }
    .ladder-row:nth-child(odd) {
      background-color: #F5F5F5;
    }
    .app-header {
      background-color: #5F7C8A;
      color: #fff;
      font-size: 20px;
      padding: 30px;
      margin: 0;
    }
    .component header {
      background-color: #CFD8DC;
      font-size: 14px;
      padding: 10px;
    }
    /* NumberBar */
    .numberbar {
      position: relative;
      width: 100%;
      height: 100%;
      overflow: hidden;
    }
    .numberbar-bar {
      position: absolute;
      top: 0;
      left: 0;
      background-color: #b1cfa7;
      height: 100%;
      width: 100%;
      z-index: 1;
    }
    .transitions .numberbar-bar {
      transition: transform 0.13s ease-out;
    }
    .numberbar-bar-ask {
      left: auto;
      right: 0;
      background-color: #e9aebc;
    }
    .numberbar-number {
      position: relative;
      z-index: 5;
    }
  </style>
</head>
<body class="transitions">
  <div id="app"></app>
  <script src='https://rawgit.com/MikeMcl/big.js/master/big.js'></script>
  <script src="ladders-bundle.js"></script>
  <script>

    var THROTTLE = 200;
    var NUMBER_OF_LADDERS = 20;

    var PriceLevel = function(price, side, throttle) {
      this.price = price;
      this.side = side;
      this.key = PriceLevel.COUNT++;

      this.bidVolume = (side === "bid") ? Math.floor(Math.random() * 400) + 100 : "";
      this.askVolume = (side === "ask") ? Math.floor(Math.random() * 400) + 100 : "";

      this._generate();
      setInterval(this._generate.bind(this), throttle);
    };
    PriceLevel.COUNT = 0;

    PriceLevel.prototype._generate = function() {
      var volumeDifference = Math.floor(Math.random() * 200) - 100;

      if (this.side === "bid") {
        var volume = this.bidVolume + volumeDifference;
        if (volume < 100) {
          volume = 100;
        } else if (volume > 500) {
          volume = 500;
        }
        this.bidVolume = volume;
      } else {
        var volume = this.askVolume + volumeDifference;
        if (volume < 100) {
          volume = 100;
        } else if (volume > 500) {
          volume = 500;
        }
        this.askVolume = volume;
      }

    };

    var OrdersModel = function() {
      this.levels = [];

      var depth = 10;
      var market = Math.floor(depth / 2) - 1;
      this.priceStart = Big(Math.random() + 1);
      this.priceStep = 0.00001;
      var throttleMin = 50;
      var throttleStep = 200;
      var price = this.priceStart;

      for (var i = 0; i < depth; i++) {

        var marketDistance = Math.abs(market - i);
        var throttle = throttleMin + (throttleStep * marketDistance);
        var diff = Number((i * this.priceStep).toFixed(5));
        price = (Number(price) - diff).toFixed(5);
        var side = (i > market) ? "ask" : "bid";

        this.levels.push(new PriceLevel(price, side, throttle));
      };

      this.maxVolume = 500;

      window.setInterval(this._moveMarket.bind(this), Math.floor(Math.random() * 700) + 400);
    };

    OrdersModel.prototype._moveMarket = function() {
      var multiplier = (Math.random() > 0.5) ? 1 : -1;
      this.priceStart = Big(this.priceStart).plus(Big(this.priceStep).times(multiplier));

      var priceStep = new Big(this.priceStep);
      var price = Big(this.priceStart);

      for (var i = 0; i < this.levels.length; i++) {
        price = Big(price.minus(priceStep));
        this.levels[i].price = price.toFixed(5).toString();
      };
    };

    var ordersModel = new OrdersModel();

    var laddersApp = new LaddersApp();
    laddersApp.mount(document.getElementById('app'));
  </script>
</body>
</html>
