<html>
<head>
  <title>Inferno example</title>
  <link rel="stylesheet" href="bootstrap.min.css">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div id="app"></div>
  <script src="im7.js"></script>
  <script src="inferno.js"></script>
  <script src="t7.js"></script>
  <script src="data.js"></script>
  <script src="lib/memory-stats.js"></script>
  <script src="lib/monitor.js"></script>
  <script>

    var state = {
      dbs: getData()
    };


    function template() {
      var map = Inferno.TemplateHelpers.map;
      var text = Inferno.TemplateHelpers.text;
      var computed = Inferno.TemplateHelpers.computed;

      return {
        tag: "table",
        attrs: [
          {
            name: "class",
            value: "table table-striped latest-data"
          }
        ],
        children: {
          tag: "tbody",
          bindMap: {
            initValue: state.dbs,
            oldValue: null,
            constructor: function(db) {
              return {
                tag: "tr",
                children: [
                  {
                    tag: "td",
                    attrs: [
                      {
                        name: "class",
                        value: "dbname"
                      }
                    ],
                    bindText: {
                      statePath: "",
                      initValue: db.name,
                      oldValue: null
                    }
                  },
                  {
                    tag: "td",
                    attrs: [
                      {
                        name: "class",
                        value: "query-count"
                      }
                    ],
                    children: {
                      tag: "span",
                      bindAttrsComputed: [
                        {
                          name: "class",
                          statePath: "",
                          initValue: db,
                          computed: getCountClassName,
                          oldValue: null,
                          oldComputed: null
                        }
                      ],
                      bindComputed: {
                        statePath: "",
                        initValue: db.queries,
                        computed: function(val) {
                          return val.length;
                        },
                        oldValue: null,
                        oldComputed: null
                      }
                    }
                  },
                  {
                    bindMap: {
                      initValue: db.topFiveQueries,
                      oldValue: null,
                      constructor: function(query) {
                        return {
                          tag: "td",
                          bindAttrsComputed: [
                            {
                              name: "class",
                              statePath: "",
                              initValue: query.elapsed,
                              computed: function(elapsed) {
                                return 'Query ' + elapsedClassName(elapsed);
                              },
                              oldValue: null,
                              oldComputed: null
                            }
                          ],
                          children: [
                            {
                              tag: "span",
                              attrs: [
                                {
                                  name: "class",
                                  value: "foo"
                                }
                              ],
                              bindComputed: {
                                statePath: "",
                                initValue: query.elapsed,
                                computed: formatElapsed,
                                oldValue: null,
                                oldComputed: null
                              }
                            }
                          ]
                        }
                      }
                    }
                  }
                ]
              }
            }
          }
        }
      }
    };

    var app = document.getElementById("app");
    var root = Inferno.append(template, state, app);

    //shortcut for dev purposes
    function u() {
      state.dbs = getData();
      Inferno.update(root, app)
      Monitoring.renderRate.ping();
      requestAnimationFrame(u);
    };

    u();

  </script>
</body>
</html>
