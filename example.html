<html>
<head>
  <title>Inferno example</title>
  <link rel="stylesheet" href="bootstrap.min.css">
</head>
<body>
  <example-app message="Hello world"></example-app>
  <div id="app"></div>

  <script src="inferno.js"></script>
  <script src="t7.js"></script>
  <script>
    "use strict";

    var closureVar = 1;

    class InfernoExample extends Inferno.Component {
        constructor() {
          super();
          this.name = "Test";
          this.className = "foo";
          this.textFieldValue = "Text!";
          this.people = null;
          this.time = null;
          this.isOn = false;
          this.formShow = true;
          this._counter = 0;
          this._handleCounter();
        }
        attached(props) {
          //we can also access our web component via this.element
          this.time = props.time;
          this.people = props.people;
        }
        detached() {

        }
        beforeRender(props) {
          this.time = props.time;
          this.people = props.people;
        }
        render() {
          if(closureVar % 5 === 1) {
            return t7`
              <div>Count is at ${ this._counter }</div>
              <div class=${ this.className }>
                <span id="bar">${ this.name }</span>
                <div id="time">The time is ${ this.time }</div>
                ${ this._renderForm() }
                ${ this.name }
                ${this.isOn === false
                  ? t7`<div>Switch is off!</div>`
                  : t7`<div>Switch is on! <span>${ this.time }</span></div>`
                }
                <button onClick=${ this._clickSwitch }>Switch!</button>
                <ul>
                  ${ this.people != null ? this.people.map(this._renderPerson.bind(this)) : null }
                </ul>
              </div>
            `;
          } else {
            return t7`
              <div>Lol</div>
            `;
          }
        }
        afterRender() {

        }
        _clickSwitch(e) {
          this.isOn = !this.isOn;
        }
        _handleCounter() {
          this._counter++;
          this.forceUpdate();
          setTimeout(this._handleCounter.bind(this), 100);
        }
        _renderPerson(person) {
          if(this._counter % 3 === 1) {
            return t7`<li>${ person }, the number is ${ this._counter }<div>foo</div></li>`;
          } else {
            return t7`<li>${ person }, the magical number is ${ this._counter }<div>foo</div></li>`;
          }
        }
        _renderForm() {
          if(this.formShow) {
            return t7`
              <form>
                <input type="text" value=${ this.textFieldValue } />
                <button onClick=${ this._turnOffForm }>Turn off form</button>
              </form>
            `;
          } else {
            return t7`
              <h2>No form!</h2>
              <button onClick=${ this._turnOnForm }>Turn on form</button>
            `;
          }
        }
        _turnOffForm(e) {
          this.formShow = false;
          e.preventDefault();
        }
        _turnOnForm(e) {
          this.formShow = true;
          e.preventDefault();
        }
    }

    Inferno.register("example-app", InfernoExample);

    var odd = true;

    setInterval(function() {
      var date = new Date();
      var people = [];
      odd = !odd;
      if(!odd) {
        people = [
          "Bob",
          "Dominic",
          "John",
          "Edward"
        ]
      } else {
        people = [
          "Jemma",
          "Charlie",
          "Harry",
          "Kieria",
          "Paul",
          "Ken"
        ]
      }

      Inferno.render(
        t7`<example-app time=${ date } people=${ people }></example-app>`,
        document.getElementById("app")
      );
    }, 1000);

    // var appElement = document.getElementById("app");
    //
    // var odd = true;
    // var isOn = false;
    //
    // setInterval(function() {
    //   //uses valid, currently widely used DOM accessors
    //   var date = new Date();
    //   var people = [];
    //   odd = !odd;
    //   if(!odd) {
    //     people = [
    //       "Bob",
    //       "Dominic",
    //       "John",
    //       "Edward"
    //     ]
    //   } else {
    //     people = [
    //       "Jemma",
    //       "Charlie",
    //       "Harry",
    //       "Kieria",
    //       "Paul",
    //       "Ken"
    //     ]
    //   }
    //
    //   var i = 0;
    //   isOn = !isOn;
    //   closureVar++;
    //
    //   console.time("update");
    //
    //   appElement.setProps({
    //     time: date.toTimeString(),
    //     people: people,
    //     isOn: isOn,
    //     textFieldValue: "value " + i
    //   });
    //
    //   console.timeEnd("update");
    //
    //   i++;
    // }, 500);

  </script>
</body>
</html>
