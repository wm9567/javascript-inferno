<html>
<head>
  <title>Inferno example</title>
  <link rel="stylesheet" href="bootstrap.min.css">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div id="app"></div>
  <script src="im7.js"></script>
  <script src="inferno.js"></script>
  <script src="t7.js"></script>
  <script src="data.js"></script>
  <script src="lib/memory-stats.js"></script>
  <script src="lib/monitor.js"></script>
  <script>

    var data = {Database: Database};
    var I = 0;
    var N = 200;

    var state = {
      dbs: []
    };

    for (var i = 0; i < N; i++) {
      state.dbs.push(new data.Database('cluster' + i));
      state.dbs.push(new data.Database('cluster' + i + 'slave'));
    }

    var computed = {
      getCountClassName: function(db) {
        var count = db.queries.length;
        var className = 'label';
        if (count >= 20) {
            className += ' label-important';
        }
        else if (count >= 10) {
            className += ' label-warning';
        }
        else {
            className += ' label-success';
        }
        return className;
      }
    };

    function database(scope, computed) {
      return {
        tag: "tr",
        children: [
          {
            tag: "td",
            attrs: [
              {
                name: "class",
                value: "dbname"
              }
            ],
            children: function(scope, computed) { return scope.name; }
          },
          {
            tag: "td",
            attrs: {
              "class": "query-count"
            },
            children: {
              tag: "span",
              attrs: [
                {
                  name: "class",
                  value: function(scope, computed) { return computed.getCountClassName(scope); }
                }
              ],
              children: function(scope, computed) { return scope.queries.length; }
            }
          },
        ]
      }
    }

    function template(scope, computed) {
      var map = Inferno.TemplateHelpers.map;
      var text = Inferno.TemplateHelpers.text;
      var computed = Inferno.TemplateHelpers.computed;

      return {
        tag: "table",
        attrs: [
          {
            name: "class",
            value: "table table-striped latest-data"
          }
        ],
        children: {
          tag: "tbody",
          children: function(scope, model) { return map(scope.dbs, database) }
        }
      }
    };

    var app = document.getElementById("app");
    var root = Inferno.append(template, state, computed, app);

    //shortcut for dev purposes
    function u() {
      for (var i = 0; i < state.dbs.length; i++) {
        state.dbs[i].update();
      };
      Inferno.update(root, app, state, computed)
      Monitoring.renderRate.ping();
      requestAnimationFrame(u);
    };

    u();

  </script>
</body>
</html>
